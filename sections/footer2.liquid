{%- comment -%}
  版本 5.0 - 無限制版 (Freedom)
  - 解放：Logo 尺寸限制，電腦版最高 500px，手機版最高 350px。
  - 解放：移除 Blocks 數量限制，現在您可以新增最多 50 個區塊。
  - 確認：Logo 下方文字功能運作正常。
  - 保留：所有 v4.0 的彈性功能 (顏色、間距、版型切換、可開關模組等)。
{%- endcomment -%}

{%- liquid
  assign social_icons_exist = false
  if settings.social_facebook_link != blank or settings.social_instagram_link != blank or settings.social_youtube_link != blank or settings.social_tiktok_link != blank or settings.social_twitter_link != blank or settings.social_pinterest_link != blank or settings.social_snapchat_link != blank or settings.social_tumblr_link != blank or settings.social_vimeo_link != blank
    assign social_icons_exist = true
  endif
-%}

<style>
  .footer-flexible {
    --color-background: {{ section.settings.background_color }};
    --color-text: {{ section.settings.text_color }};
    --color-heading: {{ section.settings.heading_color }};
    --color-link: {{ section.settings.link_color }};
    --color-brand: {{ section.settings.brand_color }};
    --footer-columns-desktop: {{ section.settings.desktop_columns }};
    --padding-top: {{ section.settings.padding_top_desktop }}px;
    --padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
    --newsletter-input-background: {{ section.settings.newsletter_input_background }};
    --newsletter-input-text-color: {{ section.settings.newsletter_text_color }};
    --newsletter-input-border-color: {{ section.settings.newsletter_border_color }};
  }
  .footer-block--logo { text-align: {{ section.settings.logo_alignment }}; }
  .footer-flexible__logo {
    max-width: {{ section.settings.logo_width_desktop }}px;
    height: auto;
    object-fit: contain;
    display: block;
  }
  .footer-flexible {
    background-color: var(--color-background);
    color: var(--color-text);
    padding-top: var(--padding-top);
    padding-bottom: var(--padding-bottom);
  }
  .footer-flexible .page-width { padding-left: 2rem; padding-right: 2rem; }
  @media screen and (min-width: 750px) { .footer-flexible .page-width { padding-left: 5rem; padding-right: 5rem; } }
  .footer-flexible a { color: var(--color-link); text-decoration: none; transition: opacity 0.3s ease, color 0.3s ease; }
  .footer-flexible a:hover { opacity: 0.8; color: var(--color-brand); }
  .footer-block__heading { color: var(--color-heading); margin: 0; font-weight: 600; font-size: 1.1rem; display: block; }
  .desktop-heading { margin-bottom: 20px; }
  .footer-block__description, .footer-block__subheading, .rte { font-size: 0.9rem; opacity: 0.9; line-height: 1.6; margin: 0; }
  .footer-block__description p, .footer-block__subheading p, .rte p { margin-top: 0; margin-bottom: 0.5rem; }
  .footer-flexible__main { display: grid; gap: 40px 30px; margin-bottom: 50px; }

  /* -- Newsletter Styles with Custom Colors -- */
  .footer-newsletter__field { position: relative; }
  .footer-newsletter__field .field__input {
    background-color: var(--newsletter-input-background);
    color: var(--newsletter-input-text-color);
    border: 1px solid var(--newsletter-input-border-color);
    border-radius: 50px;
    padding: 10px 50px 10px 20px;
    width: 100%;
    box-sizing: border-box;
  }
  .footer-newsletter__field .field__input::placeholder { color: var(--newsletter-input-text-color); opacity: 0.7; }
  .footer-newsletter__button {
    position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background-color: var(--color-brand);
    border: none; border-radius: 50%; width: 34px; height: 34px;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
    color: var(--newsletter-input-background, #FFF);
  }
  .footer-newsletter__button svg { width: 12px; stroke: currentColor; }

  /* -- Bottom Bar & Localization -- */
  .footer-flexible__bottom { padding-top: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; font-size: 0.8rem; }
  .footer-flexible__bottom--has-border { border-top: 1px solid rgba(255, 255, 255, 0.1); }
  .footer-flexible__bottom-left { display: flex; flex-wrap: wrap; align-items: center; gap: 0.5rem 1rem; }
  .footer-flexible__bottom-right { display: flex; flex-wrap: wrap; align-items: center; justify-content: flex-end; gap: 1rem 1.5rem; }
  .copyright__content { display: inline-block; }
  .footer__bottom-menu, .footer__policy-list { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 1.5rem; }
  .footer__localization { display: flex; gap: 20px; }
  .localization-form { position: relative; }
  .localization-form__select, .localization-selector {
    background-color: transparent; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; padding: 5px 10px;
    color: var(--color-text); appearance: none; -webkit-appearance: none;
  }

  /* -- Other Styles -- */
  .payment-icons { display: flex; gap: 8px; flex-wrap: wrap; list-style: none; padding: 0; margin: 0; }
  .payment-icon { height: 24px; max-width: 38px; }
  .footer-block__icon-text-wrapper { display: flex; gap: 15px; align-items: flex-start; }
  .footer-block__icon svg { width: 32px; height: auto; fill: var(--color-brand); flex-shrink: 0; }

  /* -- Desktop (min-width: 750px) -- */
  @media screen and (min-width: 750px) {
    .footer-flexible__main { grid-template-columns: repeat(var(--footer-columns-desktop, 4), 1fr); }
    .footer-accordion__icon { display: none; }
    .footer-accordion > summary { pointer-events: none; list-style: none; }
    .footer-accordion > summary::-webkit-details-marker { display: none; }
    .footer-block__heading { margin-bottom: 20px; }
  }

  /* -- Mobile (max-width: 749px) -- */
  @media screen and (max-width: 749px) {
    .footer-flexible { --padding-top: {{ section.settings.padding_top_mobile }}px; --padding-bottom: {{ section.settings.padding_bottom_mobile }}px; }
    .footer-flexible__logo { max-width: {{ section.settings.logo_width_mobile }}px; }
    .footer-flexible__main { grid-template-columns: 1fr; gap: 0; }
    .footer-block { border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .footer-flexible__main--stack .footer-block { border-bottom: none; margin-bottom: 30px; }
    .footer-flexible__main--accordion .footer-accordion > summary { display: flex; justify-content: space-between; align-items: center; list-style: none; cursor: pointer; padding: 15px 0; }
    .footer-flexible__main--accordion .footer-accordion > summary::-webkit-details-marker { display: none; }
    .footer-flexible__main--accordion .footer-accordion__icon { transition: transform 0.2s ease; width: 12px; height: 12px; }
    .footer-flexible__main--accordion .footer-accordion[open] > summary .footer-accordion__icon { transform: rotate(180deg); }
    .footer-flexible__main--accordion .footer-accordion__content { padding-bottom: 20px; }
    .footer-flexible__main--accordion .footer-accordion:not([open]) > .footer-accordion__content { display: none; }
    .footer-flexible__main--stack .footer-accordion__icon { display: none; }
    .footer-flexible__main--stack .footer-block__heading { margin-bottom: 20px; }
    .footer-flexible__bottom { flex-direction: column; text-align: center; gap: 25px; }
    .footer-flexible__bottom-left, .footer-flexible__bottom-right { flex-direction: column; gap: 20px; justify-content: center; }
  }
</style>

<footer class="footer-flexible">
  <div class="page-width">
    {%- if section.blocks.size > 0 -%}
      <div class="footer-flexible__main footer-flexible__main--{{ section.settings.mobile_layout }}">
        {%- for block in section.blocks -%}
          <div class="footer-block footer-block--{{ block.type }}" {{ block.shopify_attributes }}>

            {%- liquid
              assign heading = block.settings.heading
              assign is_accordion_block = false
              if block.type == 'link_list' or block.type == 'newsletter' or block.type == 'social' or block.type == 'text'
                assign is_accordion_block = true
              endif
              assign details_attr = ''
              if section.settings.mobile_layout == 'stack' or is_accordion_block == false
                 assign details_attr = 'open'
              endif
            -%}
            
            <details class="footer-accordion" {{ details_attr }}>
              <summary>
                {%- if heading != blank and is_accordion_block -%}
                  <span class="footer-block__heading">{{ heading | escape }}</span>
                  <div class="footer-accordion__icon">{% render 'icon-caret' %}</div>
                {%- elsif is_accordion_block == false and heading != blank -%}
                   <span class="footer-block__heading desktop-heading">{{ heading | escape }}</span>
                {%- endif -%}
              </summary>
              <div class="footer-accordion__content">
                {%- case block.type -%}
                  {%- when 'logo' -%}
                    <a href="{{ routes.root_url }}" class="footer-flexible__logo-link" style="display: inline-block; margin-bottom: 15px;">
                      {%- if block.settings.logo != blank -%}
                        {{ block.settings.logo | image_url: width: 1000 | image_tag: class: 'footer-flexible__logo', loading: 'lazy', alt: block.settings.logo.alt | default: shop.name }}
                      {%- else -%}
                        <span class="h2">{{ shop.name }}</span>
                      {%- endif -%}
                    </a>
                    {%- if block.settings.description != blank -%}
                      <div class="footer-block__description rte">{{ block.settings.description }}</div>
                    {%- endif -%}
                  {%- when 'link_list' -%}
                    <ul class="list-unstyled" style="margin:0; padding:0;">{%- for link in block.settings.menu.links -%}<li style="margin-bottom: 10px;"><a href="{{ link.url }}" class="link">{{ link.title }}</a></li>{%- endfor -%}</ul>
                  {%- when 'newsletter' -%}
                    {%- if block.settings.subheading != blank -%}<p class="footer-block__subheading" style="margin-bottom: 15px;">{{ block.settings.subheading }}</p>{%- endif -%}
                    {%- assign placeholder = block.settings.placeholder | default: 'newsletter.label' | t -%}
                    {%- form 'customer', class: 'footer-newsletter__form' -%}
                      <input type="hidden" name="contact[tags]" value="newsletter"><div class="footer-newsletter__field">
                        <input id="NewsletterForm--{{ section.id }}" type="email" name="contact[email]" class="field__input" placeholder="{{ placeholder }}" required>
                        <button type="submit" class="footer-newsletter__button" name="commit" aria-label="{{ 'newsletter.button_label' | t }}">{% render 'icon-arrow' %}</button>
                      </div>
                    {%- endform -%}
                  {%- when 'text_with_icon' -%}
                    <div class="footer-block__icon-text-wrapper">{%- if block.settings.icon != blank -%}<div class="footer-block__icon">{{ block.settings.icon }}</div>{%- endif -%}<div class="footer-block__text-content rte">{{ block.settings.text }}</div></div>
                  {%- when 'social' -%}
                    {% if social_icons_exist %}{% render 'social-icons', wrapper_class: 'social-icons-wrapper' %}{% endif %}
                  {%- when 'text' -%}
                    <div class="rte">{{ block.settings.content }}</div>
                {%- endcase -%}
              </div>
            </details>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- if section.settings.show_bottom_bar_border or section.settings.enable_country_selector or section.settings.enable_language_selector or section.settings.show_payment_icons or section.settings.show_policy_links or section.settings.menu_bottom != blank -%}
      <div class="footer-flexible__bottom{% if section.settings.show_bottom_bar_border %} footer-flexible__bottom--has-border{% endif %}">
        <div class="footer-flexible__bottom-left">
          <small class="copyright__content">© {{ 'now' | date: "%Y" }}, {{ shop.name }}.</small>
          {%- if section.settings.menu_bottom != blank -%}
            <ul class="footer__bottom-menu">{%- for link in section.settings.menu_bottom.links -%}<li><a href="{{ link.url }}">{{ link.title }}</a></li>{%- endfor -%}</ul>
          {%- endif -%}
          {%- if section.settings.show_policy_links -%}
            <ul class="footer__policy-list">{%- for policy in shop.policies -%}{%- if policy != blank -%}<li><a href="{{ policy.url }}">{{ policy.title }}</a></li>{%- endif -%}{%- endfor -%}</ul>
          {%- endif -%}
        </div>
        <div class="footer-flexible__bottom-right">
          {%- if section.settings.enable_country_selector or section.settings.enable_language_selector -%}
            <div class="footer__localization">
              {%- if section.settings.enable_country_selector and localization.available_countries.size > 1 -%}<localization-form><form method="post" action="{{ routes.cart_url }}" id="FooterCountryForm" class="localization-form"><input type="hidden" name="form_type" value="localization"><input type="hidden" name="country_code" value="{{ localization.country.iso_code }}"><select class="localization-selector" onchange="this.form.submit()">{% for country in localization.available_countries %}<option value="{{ country.iso_code }}"{% if country.iso_code == localization.country.iso_code %} selected{% endif %}>{{ country.name }} ({{ country.currency.iso_code }})</option>{% endfor %}</select></form></localization-form>{% endif -%}
              {%- if section.settings.enable_language_selector and localization.available_languages.size > 1 -%}<localization-form><form method="post" action="{{ routes.cart_url }}" id="FooterLanguageForm" class="localization-form"><input type="hidden" name="form_type" value="localization"><input type="hidden" name="locale_code" value="{{ localization.language.iso_code }}"><select class="localization-selector" onchange="this.form.submit()">{% for language in localization.available_languages %}<option value="{{ language.iso_code }}"{% if language.iso_code == localization.language.iso_code %} selected{% endif %}>{{ language.endonym_name }}</option>{% endfor %}</select></form></localization-form>{% endif -%}
            </div>
          {%- endif -%}
          {%- if section.settings.show_payment_icons -%}<ul class="payment-icons">{%- for type in shop.enabled_payment_types -%}<li class="payment-icon__item">{{ type | payment_type_svg_tag: class: 'payment-icon' }}</li>{%- endfor -%}</ul>{%- endif -%}
        </div>
      </div>
    {%- endif -%}
  </div>
</footer>

{% schema %}
{
  "name": "頁尾 (高自由度)",
  "settings": [
    { "type": "header", "content": "顏色設定 (全域)" },
    { "type": "color", "id": "background_color", "label": "背景顏色", "default": "#0F0F11" },
    { "type": "color", "id": "text_color", "label": "一般文字顏色", "default": "#A0A0A0" },
    { "type": "color", "id": "heading_color", "label": "標題顏色", "default": "#FFFFFF" },
    { "type": "color", "id": "link_color", "label": "連結顏色", "default": "#D0D0D0" },
    { "type": "color", "id": "brand_color", "label": "品牌主色 (用於按鈕、連結 hover)", "default": "#2BB9ED" },
    { "type": "header", "content": "電子報區塊專屬顏色" },
    { "type": "color", "id": "newsletter_input_background", "label": "輸入框背景顏色", "default": "#FFFFFF" },
    { "type": "color", "id": "newsletter_text_color", "label": "輸入框文字顏色", "default": "#333333" },
    { "type": "color", "id": "newsletter_border_color", "label": "輸入框邊框顏色", "default": "#FFFFFF" },
    { "type": "header", "content": "間距設定 (Spacing)" },
    { "type": "range", "id": "padding_top_desktop", "min": 0, "max": 150, "step": 5, "unit": "px", "label": "上邊距 (電腦)", "default": 80 },
    { "type": "range", "id": "padding_bottom_desktop", "min": 0, "max": 150, "step": 5, "unit": "px", "label": "下邊距 (電腦)", "default": 80 },
    { "type": "range", "id": "padding_top_mobile", "min": 0, "max": 100, "step": 5, "unit": "px", "label": "上邊距 (手機)", "default": 40 },
    { "type": "range", "id": "padding_bottom_mobile", "min": 0, "max": 100, "step": 5, "unit": "px", "label": "下邊距 (手機)", "default": 40 },
    { "type": "header", "content": "主要區塊配置" },
    { "type": "range", "id": "desktop_columns", "min": 1, "max": 6, "step": 1, "label": "電腦版欄位數量", "default": 4 },
    { "type": "select", "id": "mobile_layout", "label": "手機版顯示方式", "options": [ { "value": "accordion", "label": "摺疊選單 (推薦)" }, { "value": "stack", "label": "堆疊列表" } ], "default": "accordion" },
    { "type": "select", "id": "logo_alignment", "label": "Logo 區塊對齊 (電腦版)", "options": [ { "value": "left", "label": "靠左" }, { "value": "center", "label": "置中" }, { "value": "right", "label": "靠右" } ], "default": "left" },
    { "type": "range", "id": "logo_width_desktop", "min": 50, "max": 500, "step": 10, "unit": "px", "label": "Logo 寬度 (電腦)", "default": 180 },
    { "type": "range", "id": "logo_width_mobile", "min": 50, "max": 350, "step": 10, "unit": "px", "label": "Logo 寬度 (手機)", "default": 150 },
    { "type": "header", "content": "頁尾底部功能" },
    { "type": "checkbox", "id": "show_bottom_bar_border", "label": "顯示頁尾底部分隔線", "default": true },
    { "type": "checkbox", "id": "show_payment_icons", "label": "顯示付款方式圖示", "default": true },
    { "type": "checkbox", "id": "enable_country_selector", "label": "啟用國家/地區選擇器", "default": false },
    { "type": "checkbox", "id": "enable_language_selector", "label": "啟用語言選擇器", "default": false },
    { "type": "checkbox", "id": "show_policy_links", "label": "顯示隱私權政策連結", "default": false, "info": "自動抓取您在「設定 > 政策」中新增的頁面" },
    { "type": "link_list", "id": "menu_bottom", "label": "頁尾底部選單", "info": "可選，會顯示在版權資訊旁" }
  ],
  "blocks": [
    { "type": "logo", "name": "Logo 與品牌資訊", "limit": 1, "settings": [ { "type": "image_picker", "id": "logo", "label": "上傳 Logo" }, { "type": "richtext", "id": "description", "label": "品牌描述", "default": "<p>Stay Powered, Stay Updated.</p>" } ] },
    { "type": "link_list", "name": "連結選單", "settings": [ { "type": "text", "id": "heading", "label": "標題", "default": "產品" }, { "type": "link_list", "id": "menu", "label": "選擇選單", "default": "footer" } ] },
    { "type": "newsletter", "name": "訂閱電子報", "limit": 1, "settings": [ { "type": "text", "id": "heading", "label": "標題", "default": "保持最新狀態" }, { "type": "text", "id": "subheading", "label": "副標題", "default": "獲取獨家優惠、產品發布和實用技巧——直達您的收件匣。" }, { "type": "text", "id": "placeholder", "label": "輸入框提示文字", "default": "您的 Email 地址" } ] },
    { "type": "social", "name": "社群媒體圖示", "limit": 1, "settings": [ { "type": "text", "id": "heading", "label": "標題", "default": "關注我們" } ] },
    { "type": "text_with_icon", "name": "圖文區塊 (Anker 風格)", "settings": [ { "type": "html", "id": "icon", "label": "圖示 (SVG)" }, { "type": "richtext", "id": "text", "label": "內文", "default": "<p><strong>無憂保固</strong><br>終身客戶支援</p>" } ] },
    { "type": "text", "name": "純文字/聯絡資訊", "settings": [ { "type": "text", "id": "heading", "label": "標題", "default": "聯絡我們" }, { "type": "richtext", "id": "content", "label": "內容", "default": "<p>可在此處添加您的聯絡資訊、地址或其他文字。</p>" } ] }
  ],
  "default": { "settings": {}, "blocks": [ { "type": "logo" }, { "type": "link_list" }, { "type": "link_list" }, { "type": "newsletter" } ] }
}
{% endschema %}